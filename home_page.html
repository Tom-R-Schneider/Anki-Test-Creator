<!DOCTYPE html>
<html>

<head>
  <title>Button Click Example</title>
</head>
<link rel="stylesheet" href="webpage_design.css">
<script src="out.js"></script>
<script>
  async function parse_input() {
    let file = document.getElementById('file_input').files[0];
    console.log(file);
    window.process_file_upload(file, function(graphs) {
      console.log('graphs');
      console.log(graphs);
      document.getElementById('deck_list').innerHTML = graphs.html_graph
      document.getElementById('column_names').innerHTML = "<div>Select a deck to show columns</div>"
    document.getElementById('start_date').valueAsDate = new Date();
    });
  }
  function handle_deck_click(check_box) {
    console.log(check_box);
    if (check_box.checked) {
      console.log("yes");
      console.log(check_box.id);
      let columns = window.get_deck_info_for_id(check_box.id)
        // Create html string
        let html_string = "";
        let counter = 0;
        html_string += '<li><div>Your selected Deck Columns</div>';
        html_string += "<ul>";
        for (let column of columns) {
            let pick_list = '<select name="column_option" id="column_option' + column + '"><option value="random">random</option><option value="always_shown">always shown</option><option value="never_shown">never shown</option></select>';
            html_string += '<li><div><input type="checkbox" checked="true" onclick="handle_column_click(this)" id="check' + column + '" name="'+ column +'" >' + column + pick_list + '</div>';
            window.change_checked_column("check" + column, true);    
        }
        html_string += "</ul>";
        document.getElementById('column_names').innerHTML = html_string;


    } else {
      console.log("no");
    }
    window.change_checked_deck(check_box.id, check_box.checked);
  }

  function create_learning_plan() {

    let decks = window.get_checked_decks();
    let columns = window.get_checked_columns(); 
    for(let column_id in columns) {
      columns[column_id] = document.getElementById(column_id).getAttribute("name");
    }    
    let start_date = new Date(document.getElementById('start_date').value);
    let learning_days = 0;

    if (document.getElementById('date_duration').checked) {

      // Calculate days between the two dates
      let end_date = new Date(document.getElementById('end_date').value);
      learning_days = end_date.getTime() - start_date.getTime();
      learning_days = learning_days / (1000 * 3600 * 24);

    } else {

      learning_days = document.getElementById('input_days').value;
    }

    console.log(decks);
    console.log(columns);
    console.log(start_date);
    console.log(end_date);
    window.create_anki_learning_plan(decks, start_date, learning_days, function(learning_plan) {

      // create download link
      console.log(learning_plan);
      const element = document.createElement("a");
      
      element.href = URL.createObjectURL(new Blob([learning_plan], {type: '' }));
      element.download = "your_anki_deck_with_learning_plans.apkg";
      document.body.appendChild(element);
      element.click();
    });


  }

  function create_learning_loop() {
    let answer_seconds = parseInt(document.getElementById('seconds_after_reveal_input').value);
    let guessing_seconds = parseInt(document.getElementById('seconds_before_reveal_input').value);
    let shown_rnd_counter = parseInt(document.getElementById('random_column_count_input').value);
    let card_count = 0;
    if (document.getElementById('all_cards').checked) {
      card_count = "all";
    } else {
      card_count = parseInt(document.getElementById('selection_of_cards').value);
    }
    let decks = window.get_checked_decks();
    let column_ids = window.get_checked_columns();
    let columns = {};
    for(let column_id in column_ids) {
      columns[document.getElementById(column_id).getAttribute("name")] = document.getElementById('column_option' + column_id.replace("check", "")).value;
    }    
    window.start_learning_loop(decks, card_count, columns, shown_rnd_counter, function(random_cards) {
      console.log(random_cards);
      let n = 0;
      function loopWithDelay(random_cards) {
          setTimeout(function() {
            let html_table = '<table style="border-collapse: collapse; border: 1px solid black;">';
            
            for (let column in random_cards.questions[n]) {
              html_table += '<tr>';
              html_table += '<td style="border: 1px solid black;">' + column + '</td>';
              html_table += '<td style="border: 1px solid black;">' + random_cards.questions[n][column] + '</td>';
              html_table += '</tr>';
            }
            
            html_table += "</table>"
            document.getElementById('options').innerHTML = html_table;
            
              setTimeout(function() {
              let html_table = '<table style="border-collapse: collapse; border: 1px solid black;">';
              
              for (let column in random_cards.answers[n]) {
                html_table += '<tr>';
                html_table += '<td style="border: 1px solid black;">' + column + '</td>';
                html_table += '<td style="border: 1px solid black;">' + random_cards.answers[n][column] + '</td>';
                html_table += '</tr>';
              }
              
              html_table += "</table>"
              document.getElementById('options').innerHTML = html_table;
              n++;
              console.log(n);
              if (n < random_cards.answers.length) {
                loopWithDelay(random_cards, n);
              } else {
                n = 0;
                loopWithDelay(random_cards, n);
              }
            }, guessing_seconds * 1000);
          }, answer_seconds * 1000);
  
        
      }
      // let html_table = '<table style="border-collapse: collapse; border: 1px solid black;">';
            
      // for (let column in random_cards[n]) {
      //   html_table += '<tr>';
      //   html_table += '<td style="border: 1px solid black;">' + column + '</td>';
      //   html_table += '<td style="border: 1px solid black;">' + random_cards[n][column] + '</td>';
      //   html_table += '</tr>';
      // }
      
      // html_table += "</table>"
      // document.getElementById('options').innerHTML = html_table;
      // n++;
      loopWithDelay(random_cards)
      



    });
  }
  function handle_column_click(check_box) {

    window.change_checked_column(check_box.id, check_box.checked);
  }
</script>
<body>
  <!-- Buttons -->
  <div>
    <button class="button" onclick="showContent('button1')">Button 1</button>
    <button class="button" onclick="showContent('button2')">Button 2</button>
    <button class="button" onclick="showContent('button3')">Button 3</button>
  </div>

  <!-- Content -->
  <div class="content" id="content">
  </div>

  <script>
    // JavaScript function to change content based on button clicked
    function showContent(buttonId) {
      var content = document.getElementById('content');
      var xhr= new XMLHttpRequest();

      switch (buttonId) {
        case 'button1':
        xhr.open('GET', 'vocab_test.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;
        };
          break;
        case 'button2':
        xhr.open('GET', 'learning_plan.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;
            document.getElementById('deck_list').innerHTML = "<div>Upload your apkg file to show deck list</div>";
            document.getElementById('column_names').innerHTML = "<div>Upload your apkg file to show column names</div>";
        };
          break;
        case 'button3':
        xhr.open('GET', 'learning_loop.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;

        };
          break;
        default:
          content.innerHTML = '<p>Click a button to change the content.</p>';
      }
      xhr.send();
    }
  </script>
</body>

</html>