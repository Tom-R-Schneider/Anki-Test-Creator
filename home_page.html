<!DOCTYPE html>
<html>

<head>
  <title>Button Click Example</title>
</head>
<link rel="stylesheet" href="webpage_design.css">
<script src="out.js"></script>
<script>
  async function parse_input() {
    let file = document.getElementById('file_input').files[0];
    console.log(file);
    window.process_file_upload(file, function(graphs) {
      console.log('graphs');
      console.log(graphs);
      document.getElementById('deck_list').innerHTML = graphs.html_graph
      document.getElementById('column_names').innerHTML = "<div>Select a deck to show columns</div>"
      let html_options = window.get_option_html_for_learning_plan();
    console.log(html_options);
    document.getElementById('options').innerHTML = html_options;
    document.getElementById('start_date').valueAsDate = new Date();
    });
  }
  function handle_deck_click(check_box) {
    console.log(check_box);
    if (check_box.checked) {
      console.log("yes");
      console.log(check_box.id);
      let columns = window.get_deck_info_for_id(check_box.id)
        // Create html string
        let html_string = "";
        let counter = 0;
        html_string += '<li><div>Your selected Deck Columns</div>';
        html_string += "<ul>";
        for (let column of columns) {
            html_string += '<li><div><input type="checkbox" checked="true" onclick="handle_column_click(this)" id="check' + column + '" name="'+ column +'" >' + column + '</div>';
            window.change_checked_column("check" + column, true);    
        }
        html_string += "</ul>";
        document.getElementById('column_names').innerHTML = html_string;


    } else {
      console.log("no");
    }
    window.change_checked_deck(check_box.id, check_box.checked);
  }

  function create_learning_plan() {

    let decks = window.get_checked_decks();
    let columns = window.get_checked_columns(); 
    for(let column_id in columns) {
      columns[column_id] = document.getElementById(column_id).getAttribute("name");
    }    
    let start_date = new Date(document.getElementById('start_date').value);
    let learning_days = 0;

    if (document.getElementById('date_duration').checked) {

      // Calculate days between the two dates
      let end_date = new Date(document.getElementById('end_date').value);
      learning_days = end_date.getTime() - start_date.getTime();
      learning_days = learning_days / (1000 * 3600 * 24);

    } else {

      learning_days = document.getElementById('input_days').value;
    }

    console.log(decks);
    console.log(columns);
    console.log(start_date);
    console.log(end_date);
    window.create_anki_learning_plan(decks, start_date, learning_days, function(learning_plan) {

      // create download link
      console.log(learning_plan);
      const element = document.createElement("a");
      
      element.href = URL.createObjectURL(new Blob([learning_plan], {type: '' }));
      element.download = "your_anki_deck_with_learning_plans.apkg";
      document.body.appendChild(element);
      element.click();
    });


  }

  function handle_column_click(check_box) {

    window.change_checked_column(check_box.id, check_box.checked);
  }
</script>
<body>
  <!-- Buttons -->
  <div>
    <button class="button" onclick="showContent('button1')">Button 1</button>
    <button class="button" onclick="showContent('button2')">Button 2</button>
    <button class="button" onclick="showContent('button3')">Button 3</button>
  </div>

  <!-- Content -->
  <div class="content" id="content">
  </div>

  <script>
    // JavaScript function to change content based on button clicked
    function showContent(buttonId) {
      var content = document.getElementById('content');
      var xhr= new XMLHttpRequest();

      switch (buttonId) {
        case 'button1':
        xhr.open('GET', 'vocab_test.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;
        };
          break;
        case 'button2':
        xhr.open('GET', 'learning_plan.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;
            document.getElementById('deck_list').innerHTML = "<div>Upload your apkg file to show deck list</div>";
            document.getElementById('column_names').innerHTML = "<div>Upload your apkg file to show column names</div>";
            document.getElementById('options').innerHTML = "<div>Upload your apkg file to show options</div>";
        };
          break;
        case 'button3':
        xhr.open('GET', 'learning_loop.html', true);
        xhr.onreadystatechange= function() {
            if (this.readyState!==4) return;
            if (this.status!==200) return; // or whatever error handling you want
            content.innerHTML= this.responseText;

        };
          break;
        default:
          content.innerHTML = '<p>Click a button to change the content.</p>';
      }
      xhr.send();
    }
  </script>
</body>

</html>